# Duplicate ID å­—æ®µä¿®æ”¹æ€»ç»“

## ğŸ¯ ä¿®æ”¹ç›®æ ‡

å°† `duplicate_id` å­—æ®µä»å­˜å‚¨æ–‡æœ¬IDæ”¹ä¸ºå­˜å‚¨simhashå€¼ï¼ŒåŒæ—¶ä¿æŒ `duplication_rate` å­—æ®µä¸ºç›¸ä¼¼åº¦ç™¾åˆ†æ¯”ã€‚

## âœ… ä¿®æ”¹å†…å®¹

### 1. ä¸»è¦ä¿®æ”¹æ–‡ä»¶

**æ–‡ä»¶**: `text_deduplicator.py`

### 2. å…·ä½“ä¿®æ”¹

#### 2.1 DuplicateDetectionManager.detect_duplicates() æ–¹æ³•

**ä¿®æ”¹å‰**:
```python
'duplicate_id': duplicate_result['duplicate_with'] or 'æ— ',  # å­˜å‚¨ç›¸ä¼¼æ–‡æœ¬çš„ID
```

**ä¿®æ”¹å**:
```python
'duplicate_id': duplicate_result['simhash_value'],  # æ”¹ä¸ºsimhashå€¼
```

#### 2.2 ç©ºå†…å®¹å¤„ç†

**ä¿®æ”¹å‰**:
```python
'duplicate_id': 'æ— ',  # ç©ºå†…å®¹æ—¶å­˜å‚¨"æ— "
```

**ä¿®æ”¹å**:
```python
'duplicate_id': '0000000000000000',  # ç©ºå†…å®¹æ—¶å­˜å‚¨é»˜è®¤simhashå€¼
```

#### 2.3 SimHashå€¼æ ¼å¼ä¼˜åŒ–

**ä¿®æ”¹å‰**:
```python
'simhash_value': hex(simhash.value)  # åŒ…å«"0x"å‰ç¼€
```

**ä¿®æ”¹å**:
```python
'simhash_value': hex(simhash.value)[2:].zfill(16)  # å»æ‰"0x"å‰ç¼€ï¼Œè¡¥é½16ä½
```

## ğŸ“Š ä¿®æ”¹åçš„å­—æ®µå«ä¹‰

### duplicate_id
- **ç±»å‹**: TEXT
- **å†…å®¹**: 16ä½åå…­è¿›åˆ¶simhashå€¼
- **ç¤ºä¾‹**: `"9658fcffd392bef3"`
- **ç©ºå†…å®¹é»˜è®¤å€¼**: `"0000000000000000"`

### duplication_rate  
- **ç±»å‹**: REAL
- **å†…å®¹**: ç›¸ä¼¼åº¦ç™¾åˆ†æ¯” (0.0 - 1.0)
- **è®¡ç®—æ–¹å¼**: `1 - (hamming_distance / 64)`
- **ä¿æŒä¸å˜**: ä»ç„¶å­˜å‚¨ç›¸ä¼¼åº¦ï¼Œä¸æ˜¯æ±‰æ˜è·ç¦»

## ğŸ” æµ‹è¯•éªŒè¯

è¿è¡Œ `test_duplicate_id_simhash.py` æµ‹è¯•è„šæœ¬éªŒè¯ï¼š

```bash
python test_duplicate_id_simhash.py
```

**æµ‹è¯•ç»“æœ**:
- âœ… æ‰€æœ‰duplicate_idç°åœ¨éƒ½æ˜¯simhashæ ¼å¼
- âœ… duplication_rateä»ç„¶æ˜¯ç›¸ä¼¼åº¦ç™¾åˆ†æ¯” (0.0-1.0)  
- âœ… ç©ºå†…å®¹çš„duplicate_idæ­£ç¡®è®¾ç½®ä¸ºé»˜è®¤simhashå€¼

## ğŸ“ ç¤ºä¾‹è¾“å‡º

### ä¿®æ”¹å‰
```json
{
  "duplicate_id": "æ— ",
  "duplication_rate": 0.85
}
```

### ä¿®æ”¹å
```json
{
  "duplicate_id": "9658fcffd392bef3",
  "duplication_rate": 0.85
}
```

## ğŸš€ å½±å“èŒƒå›´

### 1. æ•°æ®åº“å­—æ®µ
- `duplicate_id`: ä»æ–‡æœ¬IDæ”¹ä¸ºsimhashå€¼
- `duplication_rate`: ä¿æŒä¸å˜ï¼ˆç›¸ä¼¼åº¦ï¼‰

### 2. APIæ¥å£
- `/api/batch_parse`: è‡ªåŠ¨ä½¿ç”¨æ–°çš„duplicate_idæ ¼å¼
- å…¶ä»–ç›¸å…³æ¥å£ä¼šè‡ªåŠ¨é€‚åº”æ–°æ ¼å¼

### 3. å¯¼å‡ºåŠŸèƒ½
- JSON/CSVå¯¼å‡ºä¼šè‡ªåŠ¨åŒ…å«æ–°çš„simhashæ ¼å¼
- å»é‡åŠŸèƒ½ä¼šåŸºäºsimhashå€¼è¿›è¡Œ

## ğŸ’¡ æŠ€æœ¯ç»†èŠ‚

### SimHashç”Ÿæˆ
- ä½¿ç”¨64ä½SimHashç®—æ³•
- çª—å£å¤§å°: 6ä¸ªå­—ç¬¦
- æ±‰æ˜è·ç¦»é˜ˆå€¼: 4ä½

### æ ¼å¼è½¬æ¢
```python
# ä»æ•´æ•°è½¬æ¢ä¸º16ä½åå…­è¿›åˆ¶å­—ç¬¦ä¸²
hex_value = hex(simhash.value)[2:].zfill(16)
```

## ğŸ”§ å…¼å®¹æ€§è¯´æ˜

### å‘åå…¼å®¹
- ç°æœ‰æ•°æ®åº“è®°å½•ä¸å—å½±å“
- æ–°è®°å½•å°†ä½¿ç”¨æ–°çš„simhashæ ¼å¼
- å¯ä»¥è¿è¡Œè¿ç§»è„šæœ¬æ›´æ–°æ—§è®°å½•

### æ•°æ®è¿ç§»
å¦‚æœéœ€è¦æ›´æ–°ç°æœ‰è®°å½•ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹SQLï¼š
```sql
-- æ›´æ–°ç°æœ‰è®°å½•çš„duplicate_idå­—æ®µï¼ˆç¤ºä¾‹ï¼‰
UPDATE sentiment_results 
SET duplicate_id = '0000000000000000' 
WHERE duplicate_id = 'æ— ' OR duplicate_id IS NULL;
```

## ğŸ“‹ æ€»ç»“

âœ… **å·²å®Œæˆ**:
- duplicate_idå­—æ®µæ”¹ä¸ºsimhashå€¼
- duplication_rateå­—æ®µä¿æŒç›¸ä¼¼åº¦
- ç©ºå†…å®¹å¤„ç†ä¼˜åŒ–
- SimHashæ ¼å¼æ ‡å‡†åŒ–
- æµ‹è¯•éªŒè¯é€šè¿‡

ğŸ¯ **æ•ˆæœ**:
- æ›´å‡†ç¡®çš„é‡å¤æ£€æµ‹æ ‡è¯†
- æ ‡å‡†åŒ–çš„simhashæ ¼å¼
- ä¿æŒåŸæœ‰çš„ç›¸ä¼¼åº¦è®¡ç®—é€»è¾‘
- æå‡ç³»ç»Ÿçš„ä¸€è‡´æ€§å’Œå¯ç»´æŠ¤æ€§






