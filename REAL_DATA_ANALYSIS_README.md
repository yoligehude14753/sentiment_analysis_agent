# 真实数据库连接与批量分析功能

## 概述

本系统已经升级为支持真实数据库连接和批量分析任务，不再使用虚拟数据。系统现在可以：

1. 连接真实的舆情数据库
2. 根据时间范围查询真实数据
3. 执行批量分析任务
4. 保存分析结果到结果数据库
5. 导出分析结果

## 主要功能

### 1. 数据查询功能

- **时间范围选择**: 支持选择开始和结束时间
- **数据量预览**: 实时显示选定时间范围内的数据量
- **数据刷新**: 可以刷新数据量统计

### 2. 批量分析功能

- **分析模块选择**: 支持选择情感分析、标签分类、企业识别等模块
- **批量处理**: 自动处理大量数据
- **进度显示**: 实时显示处理进度和状态
- **结果保存**: 自动保存分析结果到数据库

### 3. 结果管理功能

- **结果查看**: 查看已保存的分析结果
- **结果导出**: 支持CSV和JSON格式导出
- **导出选项**: 可选择导出的内容字段

## 使用方法

### 1. 启动系统

```bash
# 启动后端服务
python main.py

# 或者使用启动脚本
start.bat
```

### 2. 配置数据库

在 `config/database_config.json` 中配置数据库连接信息：

```json
{
  "舆情数据库": {
    "type": "sqlite",
    "name": "data/sentiment_analysis.db",
    "description": "存储原始舆情数据的数据库"
  },
  "分析结果数据库": {
    "type": "sqlite", 
    "name": "data/analysis_results.db",
    "description": "存储分析结果的数据库"
  }
}
```

### 3. 执行批量分析

1. 打开"执行任务"页面
2. 选择时间范围
3. 选择分析模块
4. 点击"开始执行"按钮
5. 等待分析完成
6. 查看和导出结果

### 4. 查看分析结果

1. 打开"分析结果"页面
2. 查看已保存的分析结果
3. 使用搜索和过滤功能
4. 导出需要的结果

## API接口

### 数据查询接口

- `POST /api/data/count` - 查询数据量
- `POST /api/data/query` - 查询数据列表

### 结果管理接口

- `POST /api/results/save` - 保存分析结果
- `GET /api/results/list` - 获取结果列表
- `POST /api/results/export` - 导出结果

### 分析接口

- `POST /api/analyze` - 分析单条文本

## 数据库结构

### 舆情数据表 (sentiment_data)

- `id`: 主键
- `title`: 标题
- `content`: 内容
- `source`: 来源
- `publish_time`: 发布时间
- `company_name`: 公司名称
- `industry`: 行业
- `sentiment_level`: 情感等级
- `risk_tags`: 风险标签
- `analysis_reason`: 分析原因

### 分析结果表 (analysis_results)

- `id`: 主键
- `original_id`: 原始数据ID
- `title`: 标题
- `content`: 内容
- `source`: 来源
- `publish_time`: 发布时间
- `sentiment_level`: 情感等级
- `sentiment_reason`: 情感原因
- `tags`: 标签
- `companies`: 涉及企业
- `processing_time`: 处理时间
- `processed_at`: 处理时间
- `analysis_status`: 分析状态

## 注意事项

1. **数据量限制**: 单次查询最多支持10,000条数据
2. **处理速度**: 假设每秒处理100条数据，实际速度取决于系统性能
3. **内存使用**: 大量数据处理时注意内存使用情况
4. **错误处理**: 系统会自动记录处理失败的条目
5. **结果保存**: 分析结果会自动保存，无需手动操作

## 故障排除

### 常见问题

1. **数据库连接失败**
   - 检查数据库配置文件
   - 确保数据库文件存在
   - 检查文件权限

2. **数据查询失败**
   - 检查时间格式是否正确
   - 确保数据库中有数据
   - 查看后端日志

3. **分析任务失败**
   - 检查网络连接
   - 查看任务日志
   - 确认分析模块配置

### 日志查看

系统会在控制台输出详细的日志信息，包括：
- 数据查询状态
- 分析进度
- 错误信息
- 任务完成状态

## 性能优化建议

1. **分批处理**: 对于大量数据，建议分批处理
2. **并发控制**: 避免同时运行多个分析任务
3. **资源监控**: 监控CPU和内存使用情况
4. **定期清理**: 定期清理旧的日志和临时文件

## 更新日志

- **v2.0**: 支持真实数据库连接
- **v2.1**: 添加批量分析功能
- **v2.2**: 支持结果导出功能
- **v2.3**: 优化错误处理和用户界面
